<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Year View - Excel Style</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            min-height: 100vh;
        }

        .year-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
        }

        /* Year Header */
        .year-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .year-title {
            display: inline-block;
            font-size: 24px;
            font-weight: 400;
            color: #333;
            padding: 10px 60px;
            background: #faf6f1;
            border: 1px solid #c0c0c0;
        }

        .year-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        .year-nav-btn {
            background: #f5f5f5;
            border: 1px solid #c0c0c0;
            padding: 5px 15px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .year-nav-btn:hover {
            background: #e0e0e0;
        }

        /* Calendar Grid - 3 columns */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
        }

        /* Month Card */
        .month-card {
            background: white;
        }

        .month-name {
            text-align: center;
            font-size: 14px;
            font-weight: 400;
            color: #333;
            padding: 8px 0;
        }

        /* Month Table */
        .month-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        .month-table th,
        .month-table td {
            border: 1px solid #c0c0c0;
            text-align: center;
            font-size: 11px;
            padding: 3px 2px;
            height: 22px;
        }

        /* Day Headers - Light Blue */
        .month-table th {
            background: #b4c6e7;
            font-weight: 400;
            color: #333;
        }

        /* Day Cells - Default White (Work Day) */
        .month-table td {
            background: white;
            color: #333;
            cursor: pointer;
            position: relative;
        }

        .month-table td:hover:not(.empty) {
            outline: 2px solid #4472c4;
            z-index: 10;
        }

        .month-table td.empty {
            background: white;
            cursor: default;
        }

        /* Weekend (non-working days) - Yellow */
        .month-table td.weekend {
            background: #fff2cc;
            color: #333;
        }

        /* Remote Work Day - Green */
        .month-table td.remote {
            background: #c6efce;
            color: #006100;
        }

        /* Vacation Taken - Dark Blue */
        .month-table td.vacation {
            background: #5b9bd5;
            color: white;
        }

        /* Public Holiday - Diagonal Stripes (Hatched) */
        .month-table td.holiday {
            background: repeating-linear-gradient(
                135deg,
                white,
                white 3px,
                #a6a6a6 3px,
                #a6a6a6 4px
            );
            color: #333;
        }

        /* Sick Day - Light Orange/Peach */
        .month-table td.sick {
            background: #f8cbad;
            color: #333;
        }

        /* Today indicator */
        .month-table td.today {
            font-weight: 700;
            box-shadow: inset 0 0 0 2px #c00000;
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #c0c0c0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #333;
        }

        .legend-color {
            width: 24px;
            height: 18px;
            border: 1px solid #c0c0c0;
        }

        .legend-color.workday {
            background: white;
        }

        .legend-color.remote {
            background: #c6efce;
        }

        .legend-color.weekend {
            background: #fff2cc;
        }

        .legend-color.vacation {
            background: #5b9bd5;
        }

        .legend-color.holiday {
            background: repeating-linear-gradient(
                135deg,
                white,
                white 3px,
                #a6a6a6 3px,
                #a6a6a6 4px
            );
        }

        .legend-color.sick {
            background: #f8cbad;
        }

        /* Stats Summary */
        .stats-summary {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f5f5f5;
            border: 1px solid #c0c0c0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .stat-label {
            font-size: 11px;
            color: #666;
        }

        /* Settings Panel */
        .settings-panel {
            margin-bottom: 20px;
            padding: 15px;
            background: #f5f5f5;
            border: 1px solid #c0c0c0;
        }

        .settings-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .settings-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .settings-row label {
            font-size: 12px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .settings-row select {
            padding: 3px 8px;
            font-size: 11px;
            border: 1px solid #c0c0c0;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .calendar-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .calendar-grid {
                grid-template-columns: 1fr;
            }

            body {
                padding: 10px;
            }

            .year-container {
                padding: 15px;
            }

            .stats-summary {
                flex-wrap: wrap;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="year-container">
        <div class="year-header">
            <div class="year-nav">
                <button class="year-nav-btn" onclick="changeYear(-1)">&lt; Previous Year</button>
                <button class="year-nav-btn" onclick="changeYear(1)">Next Year &gt;</button>
            </div>
            <div class="year-title" id="yearTitle">2025</div>
        </div>

        <div class="settings-panel">
            <div class="settings-title">Work Schedule Configuration</div>
            <div class="settings-row">
                <label>
                    Monday:
                    <select onchange="setWeekdayType(0, this.value)">
                        <option value="work">Work</option>
                        <option value="remote">Remote</option>
                        <option value="off">Off</option>
                    </select>
                </label>
                <label>
                    Tuesday:
                    <select onchange="setWeekdayType(1, this.value)">
                        <option value="work">Work</option>
                        <option value="remote">Remote</option>
                        <option value="off">Off</option>
                    </select>
                </label>
                <label>
                    Wednesday:
                    <select onchange="setWeekdayType(2, this.value)">
                        <option value="work">Work</option>
                        <option value="remote">Remote</option>
                        <option value="off">Off</option>
                    </select>
                </label>
                <label>
                    Thursday:
                    <select onchange="setWeekdayType(3, this.value)">
                        <option value="work">Work</option>
                        <option value="remote">Remote</option>
                        <option value="off">Off</option>
                    </select>
                </label>
                <label>
                    Friday:
                    <select onchange="setWeekdayType(4, this.value)">
                        <option value="work">Work</option>
                        <option value="remote">Remote</option>
                        <option value="off">Off</option>
                    </select>
                </label>
                <label>
                    Saturday:
                    <select onchange="setWeekdayType(5, this.value)">
                        <option value="work">Work</option>
                        <option value="remote">Remote</option>
                        <option value="off" selected>Off</option>
                    </select>
                </label>
                <label>
                    Sunday:
                    <select onchange="setWeekdayType(6, this.value)">
                        <option value="work">Work</option>
                        <option value="remote">Remote</option>
                        <option value="off" selected>Off</option>
                    </select>
                </label>
            </div>
        </div>

        <div class="stats-summary" id="statsSummary"></div>

        <div class="calendar-grid" id="calendarGrid"></div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color workday"></div>
                <span>Work Day</span>
            </div>
            <div class="legend-item">
                <div class="legend-color remote"></div>
                <span>Remote Work</span>
            </div>
            <div class="legend-item">
                <div class="legend-color weekend"></div>
                <span>Off (Weekend)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color vacation"></div>
                <span>Vacation</span>
            </div>
            <div class="legend-item">
                <div class="legend-color holiday"></div>
                <span>Public Holiday</span>
            </div>
            <div class="legend-item">
                <div class="legend-color sick"></div>
                <span>Sick Day</span>
            </div>
        </div>
    </div>

    <script>
        // English month names
        const monthNames = [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
        ];

        // English day abbreviations
        const dayNames = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

        let currentYear = 2025;

        // Weekday types: 0=Monday, 1=Tuesday, ... 6=Sunday
        // Values: 'work', 'remote', 'off'
        let weekdayTypes = {
            0: 'work',    // Monday
            1: 'work',    // Tuesday
            2: 'work',    // Wednesday
            3: 'work',    // Thursday
            4: 'off',     // Friday (80% part-time example)
            5: 'off',     // Saturday
            6: 'off'      // Sunday
        };

        // Geneva Public Holidays
        const publicHolidays = {
            2024: [
                '2024-01-01', '2024-01-02', '2024-03-29', '2024-04-01',
                '2024-05-01', '2024-05-09', '2024-05-20', '2024-08-01',
                '2024-09-05', '2024-12-25', '2024-12-31'
            ],
            2025: [
                '2025-01-01', '2025-01-02', '2025-04-18', '2025-04-21',
                '2025-05-01', '2025-05-29', '2025-06-09', '2025-08-01',
                '2025-09-11', '2025-12-25', '2025-12-31'
            ],
            2026: [
                '2026-01-01', '2026-01-02', '2026-04-03', '2026-04-06',
                '2026-05-01', '2026-05-14', '2026-05-25', '2026-08-01',
                '2026-09-10', '2026-12-25', '2026-12-31'
            ],
            2027: [
                '2027-01-01', '2027-01-02', '2027-03-26', '2027-03-29',
                '2027-05-01', '2027-05-06', '2027-05-17', '2027-08-01',
                '2027-09-09', '2027-12-25', '2027-12-31'
            ]
        };

        // Day overrides: dateStr -> 'vacation', 'sick', 'work', 'remote', 'off'
        let dayOverrides = {};

        function loadFromStorage() {
            const saved = localStorage.getItem('yearViewExcelState');
            if (saved) {
                const data = JSON.parse(saved);
                dayOverrides = data.dayOverrides || {};
                currentYear = data.currentYear || 2025;
                if (data.weekdayTypes) {
                    weekdayTypes = data.weekdayTypes;
                }
            }
            updateWeekdaySelects();
        }

        function saveToStorage() {
            localStorage.setItem('yearViewExcelState', JSON.stringify({
                dayOverrides,
                currentYear,
                weekdayTypes
            }));
        }

        function updateWeekdaySelects() {
            const selects = document.querySelectorAll('.settings-row select');
            selects.forEach((select, index) => {
                select.value = weekdayTypes[index];
            });
        }

        function setWeekdayType(dayIndex, type) {
            weekdayTypes[dayIndex] = type;
            saveToStorage();
            renderCalendar();
        }

        function changeYear(delta) {
            currentYear += delta;
            saveToStorage();
            renderCalendar();
        }

        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getFirstDayOfMonth(year, month) {
            const day = new Date(year, month, 1).getDay();
            return day === 0 ? 6 : day - 1; // Monday = 0
        }

        function formatDate(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function isPublicHoliday(dateStr) {
            const year = dateStr.substring(0, 4);
            return publicHolidays[year] && publicHolidays[year].includes(dateStr);
        }

        function isToday(year, month, day) {
            const today = new Date();
            return today.getFullYear() === year &&
                   today.getMonth() === month &&
                   today.getDate() === day;
        }

        function getWeekdayIndex(year, month, day) {
            // Returns 0-6 where 0 = Monday
            const date = new Date(year, month, day);
            const jsDay = date.getDay(); // 0 = Sunday
            return jsDay === 0 ? 6 : jsDay - 1;
        }

        function getDayClass(year, month, day) {
            const dateStr = formatDate(year, month, day);
            const weekdayIndex = getWeekdayIndex(year, month, day);

            const classes = [];

            // Priority 1: Check for manual override
            if (dayOverrides[dateStr]) {
                const override = dayOverrides[dateStr];
                if (override === 'vacation') classes.push('vacation');
                else if (override === 'sick') classes.push('sick');
                else if (override === 'remote') classes.push('remote');
                else if (override === 'off') classes.push('weekend');
                // 'work' = white, no class needed
            }
            // Priority 2: Public holidays
            else if (isPublicHoliday(dateStr)) {
                classes.push('holiday');
            }
            // Priority 3: Default weekday type
            else {
                const weekdayType = weekdayTypes[weekdayIndex];
                if (weekdayType === 'off') classes.push('weekend');
                else if (weekdayType === 'remote') classes.push('remote');
                // 'work' = white, no class needed
            }

            // Today indicator
            if (isToday(year, month, day)) {
                classes.push('today');
            }

            return classes.join(' ');
        }

        function cycleDayType(dateStr) {
            const current = dayOverrides[dateStr];

            // Cycle: none -> vacation -> sick -> remote -> off -> work -> none
            if (!current) {
                dayOverrides[dateStr] = 'vacation';
            } else if (current === 'vacation') {
                dayOverrides[dateStr] = 'sick';
            } else if (current === 'sick') {
                dayOverrides[dateStr] = 'remote';
            } else if (current === 'remote') {
                dayOverrides[dateStr] = 'off';
            } else if (current === 'off') {
                dayOverrides[dateStr] = 'work';
            } else {
                delete dayOverrides[dateStr];
            }

            saveToStorage();
            renderCalendar();
        }

        function renderMonth(year, month) {
            const daysInMonth = getDaysInMonth(year, month);
            const firstDay = getFirstDayOfMonth(year, month);

            let html = `<div class="month-card">`;
            html += `<div class="month-name">${monthNames[month]}</div>`;
            html += `<table class="month-table">`;

            // Header row
            html += `<tr>`;
            dayNames.forEach(name => {
                html += `<th>${name}</th>`;
            });
            html += `</tr>`;

            // Day cells
            let dayCount = 1;
            for (let week = 0; week < 6; week++) {
                if (dayCount > daysInMonth) break;

                html += `<tr>`;
                for (let d = 0; d < 7; d++) {
                    if ((week === 0 && d < firstDay) || dayCount > daysInMonth) {
                        html += `<td class="empty"></td>`;
                    } else {
                        const dateStr = formatDate(year, month, dayCount);
                        const dayClass = getDayClass(year, month, dayCount);
                        html += `<td class="${dayClass}" onclick="cycleDayType('${dateStr}')">${dayCount}</td>`;
                        dayCount++;
                    }
                }
                html += `</tr>`;
            }

            html += `</table>`;
            html += `</div>`;

            return html;
        }

        function calculateStats(year) {
            let workDays = 0;
            let remoteDays = 0;
            let holidays = 0;
            let vacationDays = 0;
            let sickDays = 0;
            let offDays = 0;

            for (let month = 0; month < 12; month++) {
                const daysInMonth = getDaysInMonth(year, month);
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = formatDate(year, month, day);
                    const weekdayIndex = getWeekdayIndex(year, month, day);

                    if (dayOverrides[dateStr]) {
                        const override = dayOverrides[dateStr];
                        if (override === 'vacation') vacationDays++;
                        else if (override === 'sick') sickDays++;
                        else if (override === 'remote') remoteDays++;
                        else if (override === 'off') offDays++;
                        else if (override === 'work') workDays++;
                    } else if (isPublicHoliday(dateStr)) {
                        holidays++;
                    } else {
                        const weekdayType = weekdayTypes[weekdayIndex];
                        if (weekdayType === 'off') offDays++;
                        else if (weekdayType === 'remote') remoteDays++;
                        else workDays++;
                    }
                }
            }

            return { workDays, remoteDays, holidays, vacationDays, sickDays, offDays };
        }

        function renderStats(stats) {
            document.getElementById('statsSummary').innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${stats.workDays}</div>
                    <div class="stat-label">Work Days</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.remoteDays}</div>
                    <div class="stat-label">Remote Days</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.holidays}</div>
                    <div class="stat-label">Public Holidays</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.vacationDays}</div>
                    <div class="stat-label">Vacation</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.sickDays}</div>
                    <div class="stat-label">Sick Days</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.offDays}</div>
                    <div class="stat-label">Days Off</div>
                </div>
            `;
        }

        function renderCalendar() {
            document.getElementById('yearTitle').textContent = currentYear;

            let html = '';
            for (let month = 0; month < 12; month++) {
                html += renderMonth(currentYear, month);
            }
            document.getElementById('calendarGrid').innerHTML = html;

            const stats = calculateStats(currentYear);
            renderStats(stats);
        }

        // Initialize
        loadFromStorage();
        renderCalendar();
    </script>
</body>
</html>
