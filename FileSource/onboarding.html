<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Clock Planner - Setup Wizard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg-primary: #faf6f1;
            --bg-secondary: #f5ede4;
            --bg-tertiary: #efe5d8;
            --text-primary: #5d4037;
            --text-secondary: #8d6e63;
            --text-muted: #a1887f;
            --accent: #d4a574;
            --accent-dark: #c9956a;
            --accent-light: #e8c9a8;
            --border: #d7ccc8;
            --success: #81c784;
            --warning: #ffb74d;
            --white: #ffffff;
            --shadow: rgba(93, 64, 55, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: var(--white);
            padding: 20px 40px;
            box-shadow: 0 2px 10px var(--shadow);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            margin-top: 4px;
        }

        /* Progress Bar */
        .progress-container {
            background: var(--white);
            padding: 30px 40px;
            border-bottom: 1px solid var(--border);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 40px;
            right: 40px;
            height: 3px;
            background: var(--border);
            z-index: 1;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            cursor: pointer;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 3px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.3s ease;
        }

        .progress-step.active .step-circle {
            background: var(--accent);
            border-color: var(--accent-dark);
            color: var(--white);
        }

        .progress-step.completed .step-circle {
            background: var(--success);
            border-color: var(--success);
            color: var(--white);
        }

        .step-label {
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-align: center;
            max-width: 100px;
        }

        .progress-step.active .step-label,
        .progress-step.completed .step-label {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Main Content */
        .main-content {
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
        }

        /* Step Panels */
        .step-panel {
            display: none;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 4px 20px var(--shadow);
            padding: 40px;
            animation: fadeIn 0.4s ease;
        }

        .step-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-title {
            font-size: 1.6rem;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .step-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-hint {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            color: var(--text-primary);
            background: var(--bg-primary);
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.2);
        }

        .form-input-small {
            width: 100px;
            text-align: center;
        }

        /* Days Grid */
        .days-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .day-toggle {
            display: none;
        }

        .day-label {
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .day-label:hover {
            border-color: var(--accent);
        }

        .day-toggle:checked + .day-label {
            background: var(--accent);
            border-color: var(--accent-dark);
            color: var(--white);
        }

        /* Slider */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px var(--shadow);
        }

        .slider-value {
            min-width: 60px;
            text-align: center;
            font-weight: 600;
            color: var(--accent-dark);
            font-size: 1.1rem;
        }

        /* Time Budget Display */
        .time-budget {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 24px;
            margin-top: 30px;
        }

        .time-budget-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .time-bar {
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            margin-bottom: 16px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .time-bar-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 0.85rem;
            font-weight: 500;
            transition: width 0.3s ease;
        }

        .time-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* Free Time Highlight */
        .free-time-highlight {
            background: linear-gradient(135deg, var(--accent-light) 0%, var(--accent) 100%);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            margin: 30px 0;
        }

        .free-time-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .free-time-label {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-top: 4px;
        }

        /* Template Builder */
        .template-builder {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .template-builder {
                grid-template-columns: 1fr;
            }
        }

        .template-activities {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
        }

        .template-activities h3 {
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--white);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .activity-item:hover {
            border-color: var(--accent);
        }

        .activity-item.selected {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .activity-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .activity-name {
            flex: 1;
            font-weight: 500;
        }

        .activity-duration {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .activity-remove {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0 4px;
        }

        .activity-remove:hover {
            color: #e74c3c;
        }

        /* Mini Clock Preview */
        .clock-preview {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .clock-preview h3 {
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 16px;
            align-self: flex-start;
        }

        .preview-clock {
            width: 200px;
            height: 200px;
            position: relative;
        }

        .preview-clock canvas {
            width: 100%;
            height: 100%;
        }

        /* Add Activity Form */
        .add-activity-form {
            background: var(--white);
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .add-activity-form h4 {
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .category-select {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .category-option {
            display: none;
        }

        .category-label {
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            border: 2px solid var(--border);
            transition: all 0.2s ease;
        }

        .category-option:checked + .category-label {
            border-color: currentColor;
            font-weight: 500;
        }

        /* Results Section */
        .results-section {
            text-align: center;
        }

        .results-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }

        @media (max-width: 768px) {
            .results-charts {
                grid-template-columns: 1fr;
            }
        }

        .chart-container {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
        }

        .chart-container h3 {
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .results-summary {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 24px;
            margin: 30px 0;
            text-align: left;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 16px;
        }

        .summary-item {
            background: var(--white);
            border-radius: 8px;
            padding: 16px;
        }

        .summary-item-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .summary-item-value {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 32px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
            color: var(--white);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 165, 116, 0.4);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            background: var(--bg-secondary);
        }

        .btn-outline {
            background: transparent;
            color: var(--accent-dark);
            border: 2px solid var(--accent);
        }

        .btn-outline:hover {
            background: var(--accent-light);
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        /* Region Select */
        .region-info {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .region-info-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .region-info-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header {
                padding: 16px 20px;
            }

            .header h1 {
                font-size: 1.4rem;
            }

            .progress-container {
                padding: 20px;
            }

            .step-label {
                font-size: 0.75rem;
                max-width: 60px;
            }

            .step-panel {
                padding: 24px;
            }

            .step-title {
                font-size: 1.3rem;
            }

            .free-time-value {
                font-size: 2.2rem;
            }

            .days-grid {
                justify-content: center;
            }

            .day-label {
                padding: 10px 14px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>Daily Clock Planner</h1>
        <p>Setup your personal time management system</p>
    </header>

    <div class="progress-container">
        <div class="progress-steps">
            <div class="progress-step active" data-step="1" onclick="goToStep(1)">
                <div class="step-circle">1</div>
                <div class="step-label">Year Structure</div>
            </div>
            <div class="progress-step" data-step="2" onclick="goToStep(2)">
                <div class="step-circle">2</div>
                <div class="step-label">Time Budget</div>
            </div>
            <div class="progress-step" data-step="3" onclick="goToStep(3)">
                <div class="step-circle">3</div>
                <div class="step-label">Day Template</div>
            </div>
            <div class="progress-step" data-step="4" onclick="goToStep(4)">
                <div class="step-circle">4</div>
                <div class="step-label">Your Results</div>
            </div>
        </div>
    </div>

    <main class="main-content">
        <!-- Step 1: Year Structure -->
        <div class="step-panel active" id="step1">
            <h2 class="step-title">Define Your Year Structure</h2>
            <p class="step-subtitle">Let's start by understanding your typical work schedule</p>

            <div class="form-group">
                <label class="form-label">Which days do you typically work?</label>
                <div class="days-grid">
                    <input type="checkbox" id="day-mon" class="day-toggle" checked>
                    <label for="day-mon" class="day-label">Monday</label>

                    <input type="checkbox" id="day-tue" class="day-toggle" checked>
                    <label for="day-tue" class="day-label">Tuesday</label>

                    <input type="checkbox" id="day-wed" class="day-toggle" checked>
                    <label for="day-wed" class="day-label">Wednesday</label>

                    <input type="checkbox" id="day-thu" class="day-toggle" checked>
                    <label for="day-thu" class="day-label">Thursday</label>

                    <input type="checkbox" id="day-fri" class="day-toggle" checked>
                    <label for="day-fri" class="day-label">Friday</label>

                    <input type="checkbox" id="day-sat" class="day-toggle">
                    <label for="day-sat" class="day-label">Saturday</label>

                    <input type="checkbox" id="day-sun" class="day-toggle">
                    <label for="day-sun" class="day-label">Sunday</label>
                </div>
                <p class="form-hint">Select all days that are typically work days</p>
            </div>

            <div class="form-group">
                <label class="form-label">Estimated vacation days per year</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="vacationDays" min="0" max="40" value="25" oninput="updateVacationDisplay()">
                    <span class="slider-value" id="vacationValue">25 days</span>
                </div>
                <p class="form-hint">Include paid holidays and personal time off</p>
            </div>

            <div class="form-group">
                <label class="form-label">Your region (for public holidays)</label>
                <select class="form-select" id="regionSelect" onchange="updateRegionInfo()">
                    <option value="custom">Custom / Other</option>
                    <option value="ch-ge" selected>Switzerland - Geneva (GE)</option>
                    <option value="ch-vd">Switzerland - Vaud (VD)</option>
                    <option value="ch-zh">Switzerland - Zurich (ZH)</option>
                    <option value="fr">France</option>
                    <option value="de">Germany</option>
                    <option value="us">United States</option>
                    <option value="uk">United Kingdom</option>
                </select>
                <div class="region-info" id="regionInfo">
                    <div class="region-info-title">Geneva, Switzerland</div>
                    <div class="region-info-text">Approximately 9-10 public holidays per year</div>
                </div>
            </div>

            <div class="nav-buttons">
                <div></div>
                <button class="btn btn-primary" onclick="nextStep()">Continue</button>
            </div>
        </div>

        <!-- Step 2: Time Budget -->
        <div class="step-panel" id="step2">
            <h2 class="step-title">Calculate Your Time Budget</h2>
            <p class="step-subtitle">How do you spend your essential hours each day?</p>

            <div class="form-group">
                <label class="form-label">Sleep (hours per night)</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="sleepHours" min="4" max="12" value="8" step="0.5" oninput="updateTimeBudget()">
                    <span class="slider-value" id="sleepValue">8h</span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Work / Study (hours per day)</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="workHours" min="0" max="14" value="8" step="0.5" oninput="updateTimeBudget()">
                    <span class="slider-value" id="workValue">8h</span>
                </div>
                <p class="form-hint">Include meetings, focused work, and breaks</p>
            </div>

            <div class="form-group">
                <label class="form-label">Commute (total hours per day)</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="commuteHours" min="0" max="4" value="1" step="0.5" oninput="updateTimeBudget()">
                    <span class="slider-value" id="commuteValue">1h</span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Meals & Hygiene (hours per day)</label>
                <div class="slider-container">
                    <input type="range" class="slider" id="mealsHours" min="1" max="4" value="2" step="0.5" oninput="updateTimeBudget()">
                    <span class="slider-value" id="mealsValue">2h</span>
                </div>
                <p class="form-hint">Breakfast, lunch, dinner, getting ready</p>
            </div>

            <div class="time-budget">
                <div class="time-budget-title">Your 24-Hour Day</div>
                <div class="time-bar" id="timeBar">
                    <div class="time-bar-segment" style="background: #7c9cb5; width: 33.3%">Sleep</div>
                    <div class="time-bar-segment" style="background: #e74c3c; width: 33.3%">Work</div>
                    <div class="time-bar-segment" style="background: #f39c12; width: 8.3%">Other</div>
                    <div class="time-bar-segment" style="background: #27ae60; width: 25%">Free</div>
                </div>
                <div class="time-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #7c9cb5"></div>
                        <span>Sleep</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #e74c3c"></div>
                        <span>Work</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f39c12"></div>
                        <span>Commute & Meals</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #27ae60"></div>
                        <span>Free Time</span>
                    </div>
                </div>
            </div>

            <div class="free-time-highlight">
                <div class="free-time-value" id="freeTimeValue">5h</div>
                <div class="free-time-label">of free time each work day</div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                <button class="btn btn-primary" onclick="nextStep()">Continue</button>
            </div>
        </div>

        <!-- Step 3: Template Builder -->
        <div class="step-panel" id="step3">
            <h2 class="step-title">Design Your Ideal Work Day</h2>
            <p class="step-subtitle">Add activities to create your default daily template</p>

            <div class="template-builder">
                <div class="template-activities">
                    <h3>Your Activities</h3>
                    <div id="activityList">
                        <!-- Activities will be added here -->
                    </div>

                    <div class="add-activity-form">
                        <h4>Add New Activity</h4>
                        <div class="form-group">
                            <label class="form-label">Activity Name</label>
                            <input type="text" class="form-input" id="activityName" placeholder="e.g., Morning Exercise">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Start Time</label>
                                <input type="time" class="form-input" id="activityStart" value="09:00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time</label>
                                <input type="time" class="form-input" id="activityEnd" value="10:00">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <div class="category-select" id="categorySelect">
                                <!-- Categories will be populated by JS -->
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addTemplateActivity()" style="width: 100%">Add Activity</button>
                    </div>
                </div>

                <div class="clock-preview">
                    <h3>Clock Preview</h3>
                    <div class="preview-clock">
                        <canvas id="previewClockCanvas" width="200" height="200"></canvas>
                    </div>
                    <p style="color: var(--text-muted); font-size: 0.85rem; margin-top: 12px; text-align: center;">
                        This is how your day will look on the clock
                    </p>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                <button class="btn btn-primary" onclick="nextStep()">See Results</button>
            </div>
        </div>

        <!-- Step 4: Results -->
        <div class="step-panel" id="step4">
            <h2 class="step-title">Your Personalized Plan</h2>
            <p class="step-subtitle">Here's a summary of your time management setup</p>

            <div class="results-summary">
                <h3 style="color: var(--text-primary); margin-bottom: 8px;">Year Overview</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-item-label">Work Days per Year</div>
                        <div class="summary-item-value" id="resultWorkDays">230</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">Days Off per Year</div>
                        <div class="summary-item-value" id="resultDaysOff">135</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">Free Time per Work Day</div>
                        <div class="summary-item-value" id="resultFreeTime">5h</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-item-label">Free Time per Year</div>
                        <div class="summary-item-value" id="resultYearlyFree">1,150h</div>
                    </div>
                </div>
            </div>

            <div class="results-charts">
                <div class="chart-container">
                    <h3>Your Daily Time Split</h3>
                    <canvas id="dailyChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Yearly Day Distribution</h3>
                    <canvas id="yearlyChart"></canvas>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-outline" onclick="downloadPDF()">Download PDF Report</button>
                <button class="btn btn-primary" onclick="continueToPlanner()">Continue to Full Planner</button>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="prevStep()">Back to Edit</button>
                <div></div>
            </div>
        </div>
    </main>

    <script>
        // State
        let currentStep = 1;
        let wizardData = {
            workDays: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
            vacationDays: 25,
            region: 'ch-ge',
            sleepHours: 8,
            workHours: 8,
            commuteHours: 1,
            mealsHours: 2,
            activities: []
        };

        // Categories
        const categories = [
            { id: 'work', name: 'Work', color: '#e74c3c' },
            { id: 'family', name: 'Family', color: '#27ae60' },
            { id: 'admin', name: 'Admin', color: '#f39c12' },
            { id: 'myself', name: 'Myself', color: '#16a085' },
            { id: 'goal1', name: 'Goal 1', color: '#9b59b6' },
            { id: 'goal2', name: 'Goal 2', color: '#e91e63' },
            { id: 'goal3', name: 'Goal 3', color: '#3498db' },
            { id: 'sleep', name: 'Sleep', color: '#7c9cb5' },
            { id: 'else', name: 'Other', color: '#7f8c8d' }
        ];

        // Region data
        const regionData = {
            'custom': { name: 'Custom', holidays: 0 },
            'ch-ge': { name: 'Geneva, Switzerland', holidays: 10 },
            'ch-vd': { name: 'Vaud, Switzerland', holidays: 9 },
            'ch-zh': { name: 'Zurich, Switzerland', holidays: 9 },
            'fr': { name: 'France', holidays: 11 },
            'de': { name: 'Germany', holidays: 10 },
            'us': { name: 'United States', holidays: 10 },
            'uk': { name: 'United Kingdom', holidays: 8 }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initCategories();
            initDefaultActivities();
            updateTimeBudget();
            renderActivityList();
            renderPreviewClock();
        });

        function initCategories() {
            const container = document.getElementById('categorySelect');
            container.innerHTML = categories.map((cat, i) => `
                <input type="radio" name="category" id="cat-${cat.id}" class="category-option" value="${cat.id}" ${i === 0 ? 'checked' : ''}>
                <label for="cat-${cat.id}" class="category-label" style="color: ${cat.color}">${cat.name}</label>
            `).join('');
        }

        function initDefaultActivities() {
            wizardData.activities = [
                { name: 'Sleep', start: '23:00', end: '07:00', category: 'sleep' },
                { name: 'Morning Routine', start: '07:00', end: '08:00', category: 'myself' },
                { name: 'Commute', start: '08:00', end: '08:30', category: 'else' },
                { name: 'Work', start: '08:30', end: '12:00', category: 'work' },
                { name: 'Lunch', start: '12:00', end: '13:00', category: 'else' },
                { name: 'Work', start: '13:00', end: '17:30', category: 'work' },
                { name: 'Commute', start: '17:30', end: '18:00', category: 'else' },
                { name: 'Family Time', start: '18:00', end: '20:00', category: 'family' },
                { name: 'Personal Time', start: '20:00', end: '23:00', category: 'myself' }
            ];
        }

        // Navigation
        function goToStep(step) {
            if (step < 1 || step > 4) return;
            if (step > currentStep + 1) return; // Can't skip ahead

            currentStep = step;
            updateStepUI();
        }

        function nextStep() {
            if (currentStep < 4) {
                saveCurrentStepData();
                currentStep++;
                updateStepUI();
                if (currentStep === 4) {
                    updateResults();
                    renderCharts();
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepUI();
            }
        }

        function updateStepUI() {
            // Update panels
            document.querySelectorAll('.step-panel').forEach((panel, i) => {
                panel.classList.toggle('active', i + 1 === currentStep);
            });

            // Update progress
            document.querySelectorAll('.progress-step').forEach((step, i) => {
                const stepNum = i + 1;
                step.classList.remove('active', 'completed');
                if (stepNum === currentStep) {
                    step.classList.add('active');
                } else if (stepNum < currentStep) {
                    step.classList.add('completed');
                }
            });

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveCurrentStepData() {
            if (currentStep === 1) {
                wizardData.workDays = [];
                const dayMap = { 'mon': 'Monday', 'tue': 'Tuesday', 'wed': 'Wednesday', 'thu': 'Thursday', 'fri': 'Friday', 'sat': 'Saturday', 'sun': 'Sunday' };
                Object.keys(dayMap).forEach(key => {
                    if (document.getElementById(`day-${key}`).checked) {
                        wizardData.workDays.push(dayMap[key]);
                    }
                });
                wizardData.vacationDays = parseInt(document.getElementById('vacationDays').value);
                wizardData.region = document.getElementById('regionSelect').value;
            } else if (currentStep === 2) {
                wizardData.sleepHours = parseFloat(document.getElementById('sleepHours').value);
                wizardData.workHours = parseFloat(document.getElementById('workHours').value);
                wizardData.commuteHours = parseFloat(document.getElementById('commuteHours').value);
                wizardData.mealsHours = parseFloat(document.getElementById('mealsHours').value);
            }
        }

        // Step 1 functions
        function updateVacationDisplay() {
            const value = document.getElementById('vacationDays').value;
            document.getElementById('vacationValue').textContent = value + ' days';
        }

        function updateRegionInfo() {
            const region = document.getElementById('regionSelect').value;
            const data = regionData[region];
            const infoDiv = document.getElementById('regionInfo');
            if (region === 'custom') {
                infoDiv.innerHTML = `
                    <div class="region-info-title">Custom Region</div>
                    <div class="region-info-text">Public holidays not calculated automatically</div>
                `;
            } else {
                infoDiv.innerHTML = `
                    <div class="region-info-title">${data.name}</div>
                    <div class="region-info-text">Approximately ${data.holidays} public holidays per year</div>
                `;
            }
        }

        // Step 2 functions
        function updateTimeBudget() {
            const sleep = parseFloat(document.getElementById('sleepHours').value);
            const work = parseFloat(document.getElementById('workHours').value);
            const commute = parseFloat(document.getElementById('commuteHours').value);
            const meals = parseFloat(document.getElementById('mealsHours').value);

            document.getElementById('sleepValue').textContent = sleep + 'h';
            document.getElementById('workValue').textContent = work + 'h';
            document.getElementById('commuteValue').textContent = commute + 'h';
            document.getElementById('mealsValue').textContent = meals + 'h';

            const other = commute + meals;
            const free = Math.max(0, 24 - sleep - work - other);

            document.getElementById('freeTimeValue').textContent = free + 'h';

            // Update bar
            const bar = document.getElementById('timeBar');
            const sleepPct = (sleep / 24) * 100;
            const workPct = (work / 24) * 100;
            const otherPct = (other / 24) * 100;
            const freePct = (free / 24) * 100;

            bar.innerHTML = `
                <div class="time-bar-segment" style="background: #7c9cb5; width: ${sleepPct}%">${sleep > 2 ? 'Sleep' : ''}</div>
                <div class="time-bar-segment" style="background: #e74c3c; width: ${workPct}%">${work > 2 ? 'Work' : ''}</div>
                <div class="time-bar-segment" style="background: #f39c12; width: ${otherPct}%">${other > 1 ? 'Other' : ''}</div>
                <div class="time-bar-segment" style="background: #27ae60; width: ${freePct}%">${free > 1 ? 'Free' : ''}</div>
            `;
        }

        // Step 3 functions
        function renderActivityList() {
            const container = document.getElementById('activityList');
            if (wizardData.activities.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No activities yet. Add some below!</p>';
                return;
            }

            container.innerHTML = wizardData.activities.map((act, i) => {
                const cat = categories.find(c => c.id === act.category) || categories[0];
                const duration = calculateDuration(act.start, act.end);
                return `
                    <div class="activity-item">
                        <div class="activity-color" style="background: ${cat.color}"></div>
                        <div class="activity-name">${act.name}</div>
                        <div class="activity-duration">${act.start} - ${act.end} (${duration})</div>
                        <button class="activity-remove" onclick="removeActivity(${i})">x</button>
                    </div>
                `;
            }).join('');
        }

        function calculateDuration(start, end) {
            let [sh, sm] = start.split(':').map(Number);
            let [eh, em] = end.split(':').map(Number);
            let startMin = sh * 60 + sm;
            let endMin = eh * 60 + em;
            if (endMin <= startMin) endMin += 24 * 60; // Overnight
            const dur = endMin - startMin;
            const hours = Math.floor(dur / 60);
            const mins = dur % 60;
            return hours > 0 ? (mins > 0 ? `${hours}h ${mins}m` : `${hours}h`) : `${mins}m`;
        }

        function addTemplateActivity() {
            const name = document.getElementById('activityName').value.trim();
            const start = document.getElementById('activityStart').value;
            const end = document.getElementById('activityEnd').value;
            const categoryEl = document.querySelector('input[name="category"]:checked');

            if (!name) {
                alert('Please enter an activity name');
                return;
            }

            wizardData.activities.push({
                name,
                start,
                end,
                category: categoryEl ? categoryEl.value : 'else'
            });

            // Sort by start time
            wizardData.activities.sort((a, b) => {
                const aMin = timeToMinutes(a.start);
                const bMin = timeToMinutes(b.start);
                return aMin - bMin;
            });

            document.getElementById('activityName').value = '';
            renderActivityList();
            renderPreviewClock();
        }

        function removeActivity(index) {
            wizardData.activities.splice(index, 1);
            renderActivityList();
            renderPreviewClock();
        }

        function timeToMinutes(time) {
            const [h, m] = time.split(':').map(Number);
            return h * 60 + m;
        }

        function renderPreviewClock() {
            const canvas = document.getElementById('previewClockCanvas');
            const ctx = canvas.getContext('2d');
            const size = 200;
            const center = size / 2;
            const radius = 90;

            ctx.clearRect(0, 0, size, size);

            // Draw clock face
            ctx.beginPath();
            ctx.arc(center, center, radius, 0, 2 * Math.PI);
            ctx.fillStyle = '#faf6f1';
            ctx.fill();
            ctx.strokeStyle = '#5d4037';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Draw activities
            wizardData.activities.forEach(act => {
                const cat = categories.find(c => c.id === act.category) || categories[0];
                drawClockSegment(ctx, center, radius - 5, act.start, act.end, cat.color);
            });

            // Draw center
            ctx.beginPath();
            ctx.arc(center, center, 8, 0, 2 * Math.PI);
            ctx.fillStyle = '#5d4037';
            ctx.fill();

            // Draw hour markers
            for (let i = 0; i < 12; i++) {
                const angle = (i * 30 - 90) * Math.PI / 180;
                const x1 = center + Math.cos(angle) * (radius - 10);
                const y1 = center + Math.sin(angle) * (radius - 10);
                const x2 = center + Math.cos(angle) * radius;
                const y2 = center + Math.sin(angle) * radius;
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.strokeStyle = '#5d4037';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        function drawClockSegment(ctx, center, radius, start, end, color) {
            let startMin = timeToMinutes(start);
            let endMin = timeToMinutes(end);
            if (endMin <= startMin) endMin += 24 * 60;

            // Convert to 12h clock angles
            const startAngle12 = ((startMin % 720) / 720) * 360 - 90;
            const endAngle12 = ((endMin % 720) / 720) * 360 - 90;

            // Draw segment (simplified - shows on 12h clock)
            ctx.beginPath();
            ctx.moveTo(center, center);
            ctx.arc(center, center, radius, startAngle12 * Math.PI / 180, endAngle12 * Math.PI / 180);
            ctx.closePath();
            ctx.fillStyle = color + 'aa';
            ctx.fill();
        }

        // Step 4 functions
        function updateResults() {
            const workDaysPerWeek = wizardData.workDays.length;
            const holidays = regionData[wizardData.region]?.holidays || 0;
            const workDaysPerYear = Math.round((52 * workDaysPerWeek) - wizardData.vacationDays - holidays);
            const daysOff = 365 - workDaysPerYear;
            const freeTimePerDay = Math.max(0, 24 - wizardData.sleepHours - wizardData.workHours - wizardData.commuteHours - wizardData.mealsHours);
            const freeTimePerYear = Math.round(workDaysPerYear * freeTimePerDay);

            document.getElementById('resultWorkDays').textContent = workDaysPerYear;
            document.getElementById('resultDaysOff').textContent = daysOff;
            document.getElementById('resultFreeTime').textContent = freeTimePerDay + 'h';
            document.getElementById('resultYearlyFree').textContent = freeTimePerYear.toLocaleString() + 'h';
        }

        let dailyChart, yearlyChart;

        function renderCharts() {
            const freeTime = Math.max(0, 24 - wizardData.sleepHours - wizardData.workHours - wizardData.commuteHours - wizardData.mealsHours);

            // Daily chart
            const dailyCtx = document.getElementById('dailyChart').getContext('2d');
            if (dailyChart) dailyChart.destroy();
            dailyChart = new Chart(dailyCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Sleep', 'Work', 'Commute', 'Meals', 'Free Time'],
                    datasets: [{
                        data: [wizardData.sleepHours, wizardData.workHours, wizardData.commuteHours, wizardData.mealsHours, freeTime],
                        backgroundColor: ['#7c9cb5', '#e74c3c', '#f39c12', '#9b59b6', '#27ae60'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Yearly chart
            const workDaysPerWeek = wizardData.workDays.length;
            const holidays = regionData[wizardData.region]?.holidays || 0;
            const workDays = Math.round((52 * workDaysPerWeek) - wizardData.vacationDays - holidays);
            const weekendDays = 52 * (7 - workDaysPerWeek);
            const vacationDays = wizardData.vacationDays + holidays;

            const yearlyCtx = document.getElementById('yearlyChart').getContext('2d');
            if (yearlyChart) yearlyChart.destroy();
            yearlyChart = new Chart(yearlyCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Work Days', 'Weekends', 'Vacation & Holidays'],
                    datasets: [{
                        data: [workDays, weekendDays, vacationDays],
                        backgroundColor: ['#e74c3c', '#27ae60', '#3498db'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Title
            doc.setFontSize(24);
            doc.setTextColor(93, 64, 55);
            doc.text('Daily Clock Planner', 20, 25);
            doc.setFontSize(14);
            doc.setTextColor(141, 110, 99);
            doc.text('Your Personal Time Management Plan', 20, 35);

            // Year Overview
            doc.setFontSize(16);
            doc.setTextColor(93, 64, 55);
            doc.text('Year Overview', 20, 55);

            doc.setFontSize(12);
            doc.setTextColor(60, 60, 60);
            const workDaysPerWeek = wizardData.workDays.length;
            const holidays = regionData[wizardData.region]?.holidays || 0;
            const workDays = Math.round((52 * workDaysPerWeek) - wizardData.vacationDays - holidays);
            const freeTime = Math.max(0, 24 - wizardData.sleepHours - wizardData.workHours - wizardData.commuteHours - wizardData.mealsHours);

            doc.text(`Work Days: ${wizardData.workDays.join(', ')}`, 20, 68);
            doc.text(`Work Days per Year: ${workDays}`, 20, 78);
            doc.text(`Vacation Days: ${wizardData.vacationDays}`, 20, 88);
            doc.text(`Region: ${regionData[wizardData.region]?.name || 'Custom'}`, 20, 98);

            // Daily Time Budget
            doc.setFontSize(16);
            doc.setTextColor(93, 64, 55);
            doc.text('Daily Time Budget', 20, 120);

            doc.setFontSize(12);
            doc.setTextColor(60, 60, 60);
            doc.text(`Sleep: ${wizardData.sleepHours} hours`, 20, 133);
            doc.text(`Work: ${wizardData.workHours} hours`, 20, 143);
            doc.text(`Commute: ${wizardData.commuteHours} hours`, 20, 153);
            doc.text(`Meals & Hygiene: ${wizardData.mealsHours} hours`, 20, 163);
            doc.text(`Free Time: ${freeTime} hours`, 20, 173);

            // Activities
            doc.setFontSize(16);
            doc.setTextColor(93, 64, 55);
            doc.text('Daily Activities', 20, 195);

            doc.setFontSize(10);
            doc.setTextColor(60, 60, 60);
            let y = 208;
            wizardData.activities.forEach(act => {
                const cat = categories.find(c => c.id === act.category);
                doc.text(`${act.start} - ${act.end}: ${act.name} (${cat?.name || 'Other'})`, 20, y);
                y += 8;
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
            });

            // Footer
            doc.setFontSize(10);
            doc.setTextColor(141, 110, 99);
            doc.text('Generated by Daily Clock Planner', 20, 285);

            doc.save('daily-clock-planner-setup.pdf');
        }

        function continueToPlanner() {
            // Save wizard data to localStorage in V2-Alt4 format
            const plannerState = {
                version: 3,
                templates: {
                    'Work Day': wizardData.activities.map((act, i) => ({
                        id: i + 1,
                        name: act.name,
                        startTime: act.start,
                        endTime: act.end,
                        category: act.category
                    })),
                    'Off Day': [
                        { id: 101, name: 'Sleep In', startTime: '23:00', endTime: '08:00', category: 'sleep' },
                        { id: 102, name: 'Brunch', startTime: '09:00', endTime: '10:00', category: 'family' },
                        { id: 103, name: 'Free Time', startTime: '10:00', endTime: '22:00', category: 'myself' }
                    ],
                    'Holiday': []
                },
                weekdayTemplates: {
                    'Monday': { baseType: wizardData.workDays.includes('Monday') ? 'Work Day' : 'Off Day', custom: null },
                    'Tuesday': { baseType: wizardData.workDays.includes('Tuesday') ? 'Work Day' : 'Off Day', custom: null },
                    'Wednesday': { baseType: wizardData.workDays.includes('Wednesday') ? 'Work Day' : 'Off Day', custom: null },
                    'Thursday': { baseType: wizardData.workDays.includes('Thursday') ? 'Work Day' : 'Off Day', custom: null },
                    'Friday': { baseType: wizardData.workDays.includes('Friday') ? 'Work Day' : 'Off Day', custom: null },
                    'Saturday': { baseType: wizardData.workDays.includes('Saturday') ? 'Work Day' : 'Off Day', custom: null },
                    'Sunday': { baseType: wizardData.workDays.includes('Sunday') ? 'Work Day' : 'Off Day', custom: null }
                },
                dayOverrides: {},
                dayTypes: ['Work Day', 'Off Day', 'Holiday'],
                currentDayType: 'Work Day',
                currentView: 'activities',
                currentMainView: 'weekly',
                wizardCompleted: true,
                wizardData: wizardData
            };

            localStorage.setItem('dailyPlannerStateLight', JSON.stringify(plannerState));

            // Redirect to main planner
            window.location.href = 'daily-planner-light V2-Alt4.html';
        }
    </script>
</body>
</html>
